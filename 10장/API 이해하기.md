
### API 이해하기 

- API 서비스를 제공할 수 있음. 크롤링 같은 것을 막고 API 서비스를 제공할 수 있음.

- 서버는 터질 것을 대비해서 나눠놔야 함. 그것을 MSA라고 함.   
  SNS 서버인 8001번, API 서버인 8002번 2개를 만듦  
  

### API 서버 구조 갖추기 

- Model에서는 domain이라는 것이 추가됨.  
  데이터를 무제한으로 가져가는 것이 아니라, 제한을 둠.  
  제한을 두려면 가져가는 사람이 누군지 알아야 함.  
  회원가입하고 도메인 등록해서 허가를 받아야 함  
  
- Client Secret이라는 Key를 발급해줌.  
  ENUM으로 특정 타입만 쓰도록 지정할 수 있음  
  
- 도메인 등록하는 페이지도 만들어줌.  
  한 번 냈던 에러에 대한 확실한 해결책을 알아야 함.  
  로그인을 하면 화면이 바뀜  
  
- Client Secret을 만들 때 uuid를 만듦  
  똑같은 key를 두 번 발급해주면 안되는데,  
  uuid는 그런 것이 없음  
  uuid는 보통 v1이나 v4를 많이 씀.  
  MySQL은 uuid v4는 안됨.  
  
- 도메인과 비밀키를 발급해두면 기억해야 함.  


### JWT 토큰 사용하기 

- 카카오 로그인할 때, accessToken, refreshToken 등을 봄  
  토큰이라는 것은 어떠한 문자열임  
  문자열이 어떻게 구성되어 있느냐에 따라서 이름이 달라짐  
  
- JWT는 헤더, 페이로드, 시그니처 3단계로 구성됨.  
  JWT의 특징은 데이터를 넣을 수 있음.  
  
- JWT의 장점은 시그니처에 있음   
  비밀키를 모르기 때문에 시그니처는 위조할 수 없음  
  데이터는 노출되지만 위조는 매우 어려움  
  인코딩된 데이터를 디코딩하는 것은 매우 어려움 
  
- Payload에 데이터를 잘 넣어놓으면 DB 조회를 할 필요가 없음  

- 서버를 만들 때, 데이터베이스를 조회하는 상황을 최대한 피해야 함  
  데이터베이스는 비싸기 때문에 데이터베이스로 요청을 적게 보내야 함  
  
- JWT의 단점은 토큰이 길어서 용량을 많이 차지한다는 점  
  네트워크 부분에서는 패킷이 많이 전달됨.  
  요청과 응답의 쿠키 부분이 길어짐.
  쿠키나 HTTP 헤더에 넣을 수 있음 
  
- .env 파일에 JWTSECRET을 추가함  

- 세션을 써도 되고, JWT를 써도 됨.  
  세션이 적합한 프로젝트가 있고, JWT가 적합한 프로젝트가 있음.  
  
- API 서비스는 바로 주는 것이 아니라, 도메인 등록 여부를 검사함  


### NodeCat 서버 만들기

- 요청을 보내는 서버인 NodeCat 서버를 만듦  
  
- 에러 로깅이 프로그래밍에서 매우 중요함.  

- NodeCat은 Nodebird API로부터 데이터를 가져가고 싶은 서드파티 API임  
  NodeCat은 항상 Nodebird 서버로부터 토큰을 발급 받음  
  clientSecret을 넣어서 토큰 발급 요청을 보냄  
  
- API 서버는 도메인에 clientSecret이 등록이 되어 있는지 확인을 함  
  등록이 되어 있으면 토큰을 발급해줌.  
  토큰 발급해주는 것은 sign임.  
  검사해주는 것은 verify임.  
  
- 토큰은 secret이 틀려도 에러가 나고, 유효기간이 지나도 에러가 남.  
  JWT는 검사하는 장치들이 있어서 안전하게 쓸 수 있음  
  
- 발급 받은 토큰을 API 서버로 테스트해 봄  
  verify 해서 데이터가 맞으면 req.decoded가 나옴  
  
- 토큰의 유효 기간이 지나면 에러가 발생할 수 있음  
  토큰이 만료되면 재발급을 받아야 함  
  

### NodeBird API 호출하기

- NodeBird의 데이터를 보내주는 라우트를 만들어봄  
  
- 비동기 처리를 하다가 에러가 나는 경우에는 에러 처리를 해줘야 함  

- NodeCat은 API를 실제로 사용하는 쪽임  
  request라는 함수를 하나 만듦  
  토큰이 만료되었을 때는, 자동으로 만료되는 기능까지 포함됨  
  토큰 발급 성공했으면, 원하는 주소로 요청을 보냄  
  
- 토큰이 만료되었을 때, request 함수를 다시 한 번 실행하면 토큰 재발급을 받음  
  
- 요청을 보내는 쪽에서 토큰을 통해서 유효한 사용자인지 확인해야 함  

- API를 정의하고 API에 대한 명세서를 Swagger 같은 것으로 만들어줘야 함  


  

  

  

  
  
